import{R as j,r as _}from"./index.DMVOjPfi.js";const k={};function J(t){return"init"in t}function T(t){return!!t.write}function H(t){return"v"in t||"e"in t}function C(t){if("e"in t)throw t.e;if((k?"production":void 0)!=="production"&&!("v"in t))throw new Error("[Bug] atom state is not initialized");return t.v}const D=new WeakMap;function U(t){var n;return I(t)&&!!((n=D.get(t))!=null&&n[0])}function Z(t){const n=D.get(t);n?.[0]&&(n[0]=!1,n[1].forEach(o=>o()))}function W(t,n){let o=D.get(t);if(!o){o=[!0,new Set],D.set(t,o);const e=()=>{o[0]=!1};t.then(e,e)}o[1].add(n)}function I(t){return typeof t?.then=="function"}function $(t,n,o){if(!o.p.has(t)){o.p.add(t);const e=()=>o.p.delete(t);n.then(e,e)}}function G(t,n,o){var e;const s=new Set;for(const c of((e=o.get(t))==null?void 0:e.t)||[])o.has(c)&&s.add(c);for(const c of n.p)s.add(c);return s}const tt=(t,n,...o)=>n.read(...o),nt=(t,n,...o)=>n.write(...o),et=(t,n)=>{var o;return(o=n.unstable_onInit)==null?void 0:o.call(n,t)},ot=(t,n,o)=>{var e;return(e=n.onMount)==null?void 0:e.call(n,o)},st=(t,n)=>{const o=S(t),e=o[0],s=o[9];if((k?"production":void 0)!=="production"&&!n)throw new Error("Atom is undefined or null");let c=e.get(n);return c||(c={d:new Map,p:new Set,n:0},e.set(n,c),s?.(t,n)),c},ct=t=>{const n=S(t),o=n[1],e=n[3],s=n[4],c=n[5],a=n[6],v=n[13],f=[],i=r=>{try{r()}catch(l){f.push(l)}};do{a.f&&i(a.f);const r=new Set,l=r.add.bind(r);e.forEach(d=>{var h;return(h=o.get(d))==null?void 0:h.l.forEach(l)}),e.clear(),c.forEach(l),c.clear(),s.forEach(l),s.clear(),r.forEach(i),e.size&&v(t)}while(e.size||c.size||s.size);if(f.length)throw new AggregateError(f)},it=t=>{const n=S(t),o=n[1],e=n[2],s=n[3],c=n[11],a=n[14],v=n[17],f=[],i=new WeakSet,r=new WeakSet,l=Array.from(s);for(;l.length;){const d=l[l.length-1],h=c(t,d);if(r.has(d)){l.pop();continue}if(i.has(d)){if(e.get(d)===h.n)f.push([d,h]);else if((k?"production":void 0)!=="production"&&e.has(d))throw new Error("[Bug] invalidated atom exists");r.add(d),l.pop();continue}i.add(d);for(const p of G(d,h,o))i.has(p)||l.push(p)}for(let d=f.length-1;d>=0;--d){const[h,p]=f[d];let b=!1;for(const u of p.d.keys())if(u!==h&&s.has(u)){b=!0;break}b&&(a(t,h),v(t,h)),e.delete(h)}},rt=(t,n)=>{var o,e;const s=S(t),c=s[1],a=s[2],v=s[3],f=s[6],i=s[7],r=s[11],l=s[12],d=s[13],h=s[14],p=s[16],b=s[17],u=r(t,n);if(H(u)&&(c.has(n)&&a.get(n)!==u.n||Array.from(u.d).every(([g,B])=>h(t,g).n===B)))return u;u.d.clear();let A=!0;function m(){c.has(n)&&(b(t,n),d(t),l(t))}function E(g){var B;if(g===n){const F=r(t,g);if(!H(F))if(J(g))P(t,g,g.init);else throw new Error("no atom init");return C(F)}const O=h(t,g);try{return C(O)}finally{u.d.set(g,O.n),U(u.v)&&$(n,u.v,O),(B=c.get(g))==null||B.t.add(n),A||m()}}let w,y;const Y={get signal(){return w||(w=new AbortController),w.signal},get setSelf(){return(k?"production":void 0)!=="production"&&!T(n)&&console.warn("setSelf function cannot be used with read-only atom"),!y&&T(n)&&(y=(...g)=>{if((k?"production":void 0)!=="production"&&A&&console.warn("setSelf function cannot be called in sync"),!A)try{return p(t,n,...g)}finally{d(t),l(t)}}),y}},z=u.n;try{const g=i(t,n,E,Y);return P(t,n,g),I(g)&&(W(g,()=>w?.abort()),g.then(m,m)),(o=f.r)==null||o.call(f,n),u}catch(g){return delete u.v,u.e=g,++u.n,u}finally{A=!1,z!==u.n&&a.get(n)===z&&(a.set(n,u.n),v.add(n),(e=f.c)==null||e.call(f,n))}},ut=(t,n)=>{const o=S(t),e=o[1],s=o[2],c=o[11],a=[n];for(;a.length;){const v=a.pop(),f=c(t,v);for(const i of G(v,f,e)){const r=c(t,i);s.set(i,r.n),a.push(i)}}},N=(t,n,...o)=>{const e=S(t),s=e[3],c=e[6],a=e[8],v=e[11],f=e[12],i=e[13],r=e[14],l=e[15],d=e[17];let h=!0;const p=u=>C(r(t,u)),b=(u,...A)=>{var m;const E=v(t,u);try{if(u===n){if(!J(u))throw new Error("atom not writable");const w=E.n,y=A[0];P(t,u,y),d(t,u),w!==E.n&&(s.add(u),(m=c.c)==null||m.call(c,u),l(t,u));return}else return N(t,u,...A)}finally{h||(i(t),f(t))}};try{return a(t,n,p,b,...o)}finally{h=!1}},at=(t,n)=>{var o;const e=S(t),s=e[1],c=e[3],a=e[6],v=e[11],f=e[15],i=e[18],r=e[19],l=v(t,n),d=s.get(n);if(d&&!U(l.v)){for(const[h,p]of l.d)if(!d.d.has(h)){const b=v(t,h);i(t,h).t.add(n),d.d.add(h),p!==b.n&&(c.add(h),(o=a.c)==null||o.call(a,h),f(t,h))}for(const h of d.d||[])if(!l.d.has(h)){d.d.delete(h);const p=r(t,h);p?.t.delete(n)}}},q=(t,n)=>{var o;const e=S(t),s=e[1],c=e[4],a=e[6],v=e[10],f=e[11],i=e[12],r=e[13],l=e[14],d=e[16],h=f(t,n);let p=s.get(n);if(!p){l(t,n);for(const b of h.d.keys())q(t,b).t.add(n);if(p={l:new Set,d:new Set(h.d.keys()),t:new Set},s.set(n,p),(o=a.m)==null||o.call(a,n),T(n)){const b=()=>{let u=!0;const A=(...m)=>{try{return d(t,n,...m)}finally{u||(r(t),i(t))}};try{const m=v(t,n,A);m&&(p.u=()=>{u=!0;try{m()}finally{u=!1}})}finally{u=!1}};c.add(b)}}return p},lt=(t,n)=>{var o;const e=S(t),s=e[1],c=e[5],a=e[6],v=e[11],f=e[19],i=v(t,n);let r=s.get(n);if(r&&!r.l.size&&!Array.from(r.t).some(l=>{var d;return(d=s.get(l))==null?void 0:d.d.has(n)})){r.u&&c.add(r.u),r=void 0,s.delete(n),(o=a.u)==null||o.call(a,n);for(const l of i.d.keys()){const d=f(t,l);d?.t.delete(n)}return}return r},P=(t,n,o)=>{const e=S(t)[11],s=e(t,n),c="v"in s,a=s.v;if(I(o))for(const v of s.d.keys())$(n,o,e(t,v));s.v=o,delete s.e,(!c||!Object.is(a,s.v))&&(++s.n,I(a)&&Z(a))},dt=(t,n)=>{const o=S(t)[14];return C(o(t,n))},ft=(t,n,...o)=>{const e=S(t),s=e[12],c=e[13],a=e[16];try{return a(t,n,...o)}finally{c(t),s(t)}},ht=(t,n,o)=>{const e=S(t),s=e[12],c=e[18],a=e[19],f=c(t,n).l;return f.add(o),s(t),()=>{f.delete(o),a(t,n),s(t)}},K=new WeakMap,S=t=>{const n=K.get(t);if((k?"production":void 0)!=="production"&&!n)throw new Error("Store must be created by buildStore to read its building blocks");return n};function vt(...t){const n={get(e){const s=S(n)[21];return s(n,e)},set(e,...s){const c=S(n)[22];return c(n,e,...s)},sub(e,s){const c=S(n)[23];return c(n,e,s)}},o=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},tt,nt,et,ot,st,ct,it,rt,ut,N,at,q,lt,P,dt,ft,ht,void 0].map((e,s)=>t[s]||e);return K.set(n,Object.freeze(o)),n}const Q={};let pt=0;function Et(t,n){const o=`atom${++pt}`,e={toString(){return(Q?"production":void 0)!=="production"&&this.debugLabel?o+":"+this.debugLabel:o}};return typeof t=="function"?e.read=t:(e.init=t,e.read=gt,e.write=St),e}function gt(t){return t(this)}function St(t,n,o){return n(this,typeof o=="function"?o(t(this)):o)}function bt(){return vt()}let M;function mt(){return M||(M=bt(),(Q?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=M),globalThis.__JOTAI_DEFAULT_STORE__!==M&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),M}const At={},wt=_.createContext(void 0);function X(t){return _.useContext(wt)||mt()}const V=t=>typeof t?.then=="function",x=t=>{t.status||(t.status="pending",t.then(n=>{t.status="fulfilled",t.value=n},n=>{t.status="rejected",t.reason=n}))},_t=j.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(x(t),t)}),R=new WeakMap,L=(t,n)=>{let o=R.get(t);return o||(o=new Promise((e,s)=>{let c=t;const a=i=>r=>{c===i&&e(r)},v=i=>r=>{c===i&&s(r)},f=()=>{try{const i=n();V(i)?(R.set(i,o),c=i,i.then(a(i),v(i)),W(i,f)):e(i)}catch(i){s(i)}};t.then(a(t),v(t)),W(t,f)}),R.set(t,o)),o};function kt(t,n){const{delay:o,unstable_promiseStatus:e=!j.use}={},s=X(),[[c,a,v],f]=_.useReducer(r=>{const l=s.get(t);return Object.is(r[0],l)&&r[1]===s&&r[2]===t?r:[l,s,t]},void 0,()=>[s.get(t),s,t]);let i=c;if((a!==s||v!==t)&&(f(),i=s.get(t)),_.useEffect(()=>{const r=s.sub(t,()=>{if(e)try{const l=s.get(t);V(l)&&x(L(l,()=>s.get(t)))}catch{}if(typeof o=="number"){setTimeout(f,o);return}f()});return f(),r},[s,t,o,e]),_.useDebugValue(i),V(i)){const r=L(i,()=>s.get(t));return e&&x(r),_t(r)}return i}function yt(t,n){const o=X();return _.useCallback((...s)=>{if((At?"production":void 0)!=="production"&&!("write"in t))throw new Error("not writable atom");return o.set(t,...s)},[o,t])}function Bt(t,n){return[kt(t),yt(t)]}export{yt as a,Et as b,Bt as c,kt as u};
